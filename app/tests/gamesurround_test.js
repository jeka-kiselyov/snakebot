const expect = require('chai').expect;
const assert = require('chai').assert;

const ArrayHelper = require('../classes/ArrayHelper.js');
const UIHelper = require('../classes/UIHelper.js');
const GameSurround = require('../classes/GameSurround.js');
const GameClient = require('../classes/GameClient.js');
const GameBoardConstants = require('../classes/GameBoardConstants.js');

const path = require('path');

///// original board is stored in "testlevels/basic.dat"
///// transposed to orientation of player's snake head to:
///
// ┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐                                                                     
// │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │                                                                     
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤                                                                     
// │ ☼ │   │   │   │   │ ○ │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ ☼ │ ☼ │                                                                     
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤                                                                     
// │ ☼ │   │   │   │   │   │   │   │   │   │   │   │ ○ │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ ☼ │ ☼ │                                                                     
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤                                                                     
// │ ☺ │ × │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ # │ ☼ │                                                                     
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤                                                                     
// │ ☼ │   │   │   │   │   │   │   │   │   │   │   │   │   │ ● │   │   │   │   │   │   │ ○ │   │   │   │   │ ○ │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │ ○ │   │   │ ○ │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ ● │   │ ○ │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │ ☼ │   │   │   │   │ ○ │ ☼ │   │   │   │   │   │   │   │   │   │   │ ● │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │ ☼ │   │   │   │   │   │ ☼ │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │ ☼ │   │   │ ☼ │   │   │ ☼ │   │   │   │   │   │ ☼ │   │   │   │ ☼ │   │   │   │   │   │   │ # │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │ © │   │   │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │   │ ● │   │   │   │ ☼ │   │   │   │ ☼ │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │ # │ ☼ │   │   │   │ ☼ │ ☼ │   │   │   │   │   │ # │ ☼ │ ☼ │ ☼ │ ☼ │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │ $ │   │   │   │   │   │ © │   │ ☼ │ ☼ │ ☼ │ ☼ │   │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │   │   │   │ ® │   │   │ ☼ │ ☼ │ ☼ │   │   │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │ ○ │   │   │   │   │   │   │   │   │   │   │   │   │ ○ │   │   │ ○ │   │   │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ # │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ ○ │   │   │ ● │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │ ☼ │   │ ○ │   │   │   │   │ $ │   │   │   │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │ ☼ │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │ ® │   │ # │ ☼ │ ☼ │ ☼ │ ☼ │   │   │   │   │   │   │ # │ ☼ │ ☼ │ ☼ │ ☼ │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │ ● │   │   │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │   │   │   │ ○ │   │   │   │   │ ☼ │ ☼ │ ☼ │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │ # │ ☼ │ ☼ │ ☼ │ ☼ │   │ © │ ○ │   │   │ ● │   │   │ ☼ │ ☼ │ ☼ │   │   │   │   │   │ # │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │ ○ │   │   │   │   │   │   │   │   │ ○ │   │   │   │   │   │   │   │ ☼ │ ☼ │ ☼ │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │ ▼ │   │   │   │   │ ● │   │   │   │   │   │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │ ║ │   │   │   │   │   │ ● │   │   │   │   │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │ ║ │   │   │   │   │   │   │   │   │ ● │   │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │ ╓ │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ # │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │ ☼ │ ☼ │
// ├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
// │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │ ☼ │
// └───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┘


describe('GameSurround', function() {
	it('initializes like a sweety from basic.dat', async function() {
		let gc = new GameClient();
		await gc.loadBoardFromFile(path.join(__dirname, 'testlevels/basic.dat'));
		expect(gc.board.size).to.equal(30);

		let afSurround = gc.board.allFieldSurround;
		/// allFieldSurround is GameSurround oriented by forward player snake's direction
		
		expect(afSurround.width).to.equal(30);
		expect(afSurround.height).to.equal(30);

		expect(afSurround.headPosition.x).to.equal(11); /// original facing south, rotated 2 times, original x = 18, 30 - 18 - 1 = 11
		expect(afSurround.headPosition.y).to.equal(24); /// original facing south, rotated 2 times, original y = 5, 30 - 5 - 1 = 24

		///// get player's snake length correctly
		expect(afSurround.playerSnakeLength).to.equal(4);
	});

	it('determines player (fury, fly, regular) status correctly', async function(){
		let gc = new GameClient();
		await gc.loadBoardFromFile(path.join(__dirname, 'testlevels/playersnake_length_8.dat'));
		expect(gc.board.allFieldSurround.playerSnakeLength).to.equal(8);

		gc = new GameClient();
		await gc.loadBoardFromFile(path.join(__dirname, 'testlevels/playersnake_length_6.dat'));
		expect(gc.board.allFieldSurround.playerSnakeLength).to.equal(6);
	});

	it('determines different player snake length correctly', async function(){
		let gc = new GameClient();
		await gc.loadBoardFromFile(path.join(__dirname, 'testlevels/basic.dat'));
		expect(gc.board.allFieldSurround.isPlayerFury()).to.equal(false);
		expect(gc.board.allFieldSurround.isPlayerFly()).to.equal(false);

		gc = new GameClient();
		await gc.loadBoardFromFile(path.join(__dirname, 'testlevels/playersnake_is_fury.dat'));
		expect(gc.board.allFieldSurround.isPlayerFury()).to.equal(true);
		expect(gc.board.allFieldSurround.isPlayerFly()).to.equal(false);

		gc = new GameClient();
		await gc.loadBoardFromFile(path.join(__dirname, 'testlevels/playersnake_is_fly.dat'));
		expect(gc.board.allFieldSurround.isPlayerFury()).to.equal(false);
		expect(gc.board.allFieldSurround.isPlayerFly()).to.equal(true);
	});
});